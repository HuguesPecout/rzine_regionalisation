---
title: "Classification et régionalisation"
subtitle: "Application aux résultats des élections européennes de 2024 en France métropolitiane"
date: "`r Sys.Date()`"
author: 
 - name: CLaude GRASLAND
   affiliation: Université Paris Cité - département de géographie,  UMR 8504 Géographie-cités - équipe TERMS
image: "featured.png"   
logo: "figures/rzine.png"  
output:
  rzine::readrzine:
    highlight: kate
    number_sections: true
csl: Rzine_citation.csl
bibliography: biblio.bib
nocite: |
  @*
link-citations: true
# github: "author/repository"
# gitlab: "gitlab.huma-num.fr/author/repository"
# doi: "xx.xxx/xxxx.xxxxxxx"
# licence: "by-sa"

# Only Creative Commons Licence 
# 5 possible choices : "by-nd", "by", "by-nc-sa", "by-nc","by-sa"
---

```{r setup, include=FALSE}

## Global options
knitr::opts_chunk$set(echo=TRUE,
        	            cache=FALSE,
                      prompt=FALSE,
                      comment=NA,
                      message=FALSE,
                      warning=FALSE,
                      class.source="bg-info",
                      class.output="bg-warning")

# Packages d'affichage
library(knitr)

# Packages utilitaires
library(readxl)
library(dplyr)

# Packages cartographiques
library(sf)
library(mapsf)

```


> Le résumé de votre fiche dans cet encart

# Introduction {-}

Rédigez en [langage de balisage **markdown**](https://fr.wikipedia.org/wiki/Markdown) pour mettre en forme votre texte. 

Si vous avez besoin de définir un mot/expression, utilisez la syntaxe suivante : Mot/expression à définir^[__Mot/expression à définir__ Définition du mot/expression... etc.]   
La définition sera automatiquement ajoutée dans la partie [**Glossaire**](#endnotes).   

Pour afficher une référence bibliographique, ajoutez-la dans le fichier biblio.bib en format [BibTeX](https://fr.wikipedia.org/wiki/BibTeX).    
Vous pouvez ensuite l'appeler dans le corps document de cette manière : @R-base  
Toutes les références indiquées dans le fichier biblio.bib sont automatiquement ajoutées dans la [**Bibliographie**](#bibliographie).

Il est possible d'écrire des formules mathématiques en langage $\TeX$. Pour cela, il suffit de délimiter le contenu $\LaTeX$ par **un ou deux** symboles **$**, ex :  

```
$$ y = \sqrt{\frac{1}{x + \beta}} $$ 
```
En mode ***Inline*** (**1 $**) , les formules sont incluses à l'intérieur du paragraphe courant, ex : $\sum_{i=1}^n X_i$    
En mode ***Displayed*** (**2 $**), elles apparaissent centrées et mises en exergue, ex : $$ y = \sqrt{\frac{1}{x + \beta}} $$   


Pour mettre en valeur un bloc de texte, vous pouvez utilisez une **div** ***alert-success*** [**bootstrap**](https://getbootstrap.com/docs/4.0/components/alerts/) comme ceci :
<div class="alert alert-success" role="alert">
Mettre en valeur un bloc de texte...</div>


Pour afficher une information importante, vous pouvez utilisez une **div** ***alert-danger*** [**bootstrap**](https://getbootstrap.com/docs/4.0/components/alerts/) comme ceci :
<div class="alert alert-danger" role="alert">
Afficher une information importante...</div>


Pour afficher une image dans le corps du document, utilisez un chunk  : 
```{r, echo=FALSE, out.width="50%",  fig.align = 'center'}
knitr::include_graphics("figures/rzine.png")
```


# Partie A

## Partie A.1

### Partie A.1.1

### Partie A.1.2

### Partie A.1.3

## Partie A.2

## Partie A.3

## Partie A.4

# Partie B

## Partie B.1

## Partie B.2

# Partie C

## Partie C.1

## Partie C.2

## Partie C.3

# Partie D

## Partie D.1

## Partie D.2



# Bibliographie {-}

<div id="refs"></div>



# Annexes {-}

## Source des données brutes {-}

- le fichier *résultats-définitifs-par-circonscriptions.csv* qui se trouve dans le dossier **data/raw** est accesible sur le site data.gouv.fr en suivant [ce lien](https://www.data.gouv.fr/fr/datasets/resultats-des-elections-europeennes-du-9-juin-2024/). Il présente les résultats définitifs des élections europénnes et a pour origine le Ministère de l'Intérieur. Comme il est très complexe (beaucoup de colonnes redondantes) nous l'avons largement modifié pour créer les fichiers *don-circ.csv* et *don-circ.RDS* qui se trouvent dans le dossier **data/net**.

- le fichier *indic-stat-circonscriptions-legislatives-2022.xls* se trouve également dans le dossier **data/raw** a été produit par l'INSEE et est accessible en suivant [ce lien](https://www.insee.fr/fr/statistiques/6436476?sommaire=6436478). Il fournit un ensemble de données de cadrage sociales et économiques sur les circonscriptions législatives de France à partir des données du recensement de 2022 et de quelques autres sources. 

- le fichier *circo_composition.xls* également accessible sur le même lien permet de mettre en rapport les circonscription avec les départements, les régions ou les communes. Sachant qu'une même commune peut participer à deux circonscriptions ou plus. On s'en servira principalement pour établir le lien entre circonscriptions et régions. 

- le fichier *france_circonsscriptions_legislatives_2012.json* contient un fichier simplifié des circonscriptions législatives en vigueur depuis 2012.  C'est une reprise du travail de Toxicode. L'Atelier de cartographie de Sciences Po à ensuite vérifié, nettoyé et généralisé le fond. Il est accessible sur le site data.gouv.fr en suivant  [ce lien](https://www.data.gouv.fr/fr/datasets/carte-des-circonscriptions-legislatives-2012-et-2017/#/resources).  Il est beaucoup plus léger et mieux généralisé que le fonds de carte fournit par l'INSEE avec les deux ressources précédentes



## Préparation des données géométriques {-}

On charge le fichier des circonscriptions en ne conservant que les données de France métropolitaine hors Corse, soit 533 circonscriptions. On le projette en EPSG 2154 puis on l'agrège par département et régions pôir disposer de trois fonds de cartes. 

```{r, eval=FALSE}

# Charge le fonds de carte
map<-st_read("data/raw/france-circonscriptions-legislatives-2012.json")

# Charge la table de correspondance entre circonscriptions, départements et régions
meta<-read_xlsx("data/raw/circo_composition.xlsx",sheet= "table") 


# Harmonise les noms et codes de départements et régions
meta <- meta %>%
    select(circ=circo, dept= DEP,dept_nom=libdep, regi=REG, regi_nom = libreg) %>%
    filter(substr(circ,1,2) == dept) %>%   # CORRIGE DES ERREURS DE CODAGE DE L'INSEE
  unique()



# Crée la carte des circonscriptions
map_circ <- map %>% 
                    mutate(circ=ID) %>%
                    select(circ)     %>%
                    left_join (meta) %>%     
                    filter(nchar(dept)<3,                   # Elimine les DROM
                      ! dept %in% c("2A","2B")) %>%         # Elimine la Corse#
                    arrange(regi, dept,circ) %>%
                    st_transform(2154)                         # Change la projection
saveRDS(map_circ, "data/net/map_circ.RDS")



# Agrège par département 
map_dept <- map_circ %>% group_by(dept) %>%
                        summarize(dept_nom=min(dept_nom),
                                  regi=min(regi),
                                  regi_nom = min(regi_nom)) %>%
                        st_buffer(dist=200)
saveRDS(map_dept, "data/net/map_dept.RDS")

# Agrège par région
map_regi <- map_dept %>% group_by(regi) %>%
                        summarise(regi_nom = min(regi_nom))
saveRDS(map_regi, "data/net/map_regi.RDS")


```

On affiche les trois fonds de carte pour vérification:

```{r carte test}
# Chargement
map_circ <- readRDS("data/net/map_circ.RDS")
map_dept <- readRDS("data/net/map_dept.RDS")
map_regi <- readRDS("data/net/map_regi.RDS")

# Verification du fonds de carte
mf_map(map_circ, type = "base", col="lightyellow", border="gray80", lwd=0.4)
mf_map(map_dept, type = "base", col=NA, border="gray50", lwd=0.8, add=T)
mf_map(map_regi, type = "base", col=NA, border="gray20", lwd=1.6, add=T)
mf_layout(title = "Superposition des trois fonds de carte",
          credits = "Source : Toxicode & Atelier de Cartographie de Science Po
Auteur : Claude Grasland, 2024",
          frame = T)

```

## Préparation des données électorales {-}

Nous allons extraire du fichier électoral les effectifs bruts de vote pour les candidats des différentes listes en remplaçant le nom de la liste par celui du candidat et en ne retenant queles candidats qui ont reçu des voix dans toutes les circonscriptions. Les candidats qui n'ont pas reçu de voix dans toutes les circonscriptions seront placés dans la catégorie "Autres". 













## Info session  {-}

```{r session_info, echo=FALSE}
kableExtra::kable_styling(knitr::kable(rzine::sessionRzine()[[1]], row.names = F))
kableExtra::kable_styling(knitr::kable(rzine::sessionRzine()[[2]], row.names = F))
```

## Citation {-}

```{r Citation, echo=FALSE}
rref <- bibentry(
   bibtype = "misc",
   title = "Classification et Régionalisation",
   subtitle = "Application aux résultats des élections européennes de 2024 en France métropolitiane",
   author = c("Claude Grasland"),
   doi = "10.48645/xxxxxx",
   url = "https://rzine.fr/publication_rzine/xxxxxxx/",
   keywords ="FOS: Other social sciences",
   language = "fr",
   publisher = "FR2007 CIST",
   year = 2021,
   copyright = "Creative Commons Attribution Share Alike 4.0 International")

``` 

`r capture.output(print(rref))`

### BibTex : {-}

```{r generateBibTex, echo=FALSE}

writeLines(toBibtex(rref), "cite.bib")
toBibtex(rref)

``` 

<br/>

## Glossaire {- #endnotes}

```{js, echo=FALSE}

$(document).ready(function() {
  $('.footnotes ol').appendTo('#endnotes');
  $('.footnotes').remove();
});

```
